package client;

import java.awt.Frame;

import javax.media.MediaLocator;

import connection.DBConnSingleton;
import connection.DatabaseConnectionManager;
import connection.WebConnSingleton;
import connection.WebConnectionManager;
import motiondetection.MotionDetector;
import motiondetection.MotionEvent;
import motiondetection.MotionListener;
import motiondetection.MotionListenerInterface;

public class Control implements MotionListenerInterface, SystemStateChangeInterface {
	
	private MotionDetector motionDetector = null;
	private DatabaseConnectionManager dbConnManager = null;
	private WebConnectionManager webConnManager = null;
	
	
	/**
	 * Constructor: Takes a frame that will display the results from the motion detection, and 
	 * also takes the location of the media to be used (Camera feed)
	 * @param frame
	 */
	public Control(MediaLocator ds, Frame frame) {
		MotionListener.addMotionListener(this);
		dbConnManager = DBConnSingleton.getInstance();
		webConnManager = WebConnSingleton.getInstance();
		motionDetector = new MotionDetector(ds, frame);
	}
	
	
	
	
	public void startBroadcast() {
		
	}
	
	
	public void stopBroadcast() {
		
	}
	
	
	public void cleanup() {
		dbConnManager.disconnect();
		webConnManager.stopBroadcast();
	}
	
	
	public Frame getFrame() {
		return motionDetector.getFrame();
	}
	

	/**
	 * The motion event handler for this class. When motion 
	 * is detected, this function is called.
	 * @param motionevent (MotionEvent)
	 * @return void
	 */
	public void motion(MotionEvent me) {
		if (!SystemState.Recording && SystemState.Activated)
		{
			// TODO
			// Start Recording / Broadcasting
		}
	}


	/**
	 * Called when the system state changes. Handles the resulting logic.
	 * @param StateChangeEvent
	 */
	public void stateChanged(StateChangeEvent sce) {
		if(!SystemState.Activated)
		{
			// TODO
			// System has changed from activated to deactivated
			// stop trigger / recording / etc
		}
	}
}
